!function(e){function t(t){for(var a,l,o=t[0],i=t[1],s=t[2],d=0,m=[];d<o.length;d++)l=o[d],Object.prototype.hasOwnProperty.call(r,l)&&r[l]&&m.push(r[l][0]),r[l]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);for(u&&u(t);m.length;)m.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,o=1;o<n.length;o++){var i=n[o];0!==r[i]&&(a=!1)}a&&(c.splice(t--,1),e=l(l.s=n[0]))}return e}var a={},r={0:0},c=[];function l(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.m=e,l.c=a,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(n,a,function(t){return e[t]}.bind(null,a));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var o=window.webpackJsonp=window.webpackJsonp||[],i=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var u=i;c.push([76,1]),n()}({13:function(e,t,n){"use strict";(function(e){n.d(t,"g",(function(){return l}));var a=n(54),r=n(22),c=n(28);n(16);n.d(t,"a",(function(){return c.a})),n.d(t,"b",(function(){return c.b})),n.d(t,"c",(function(){return c.c})),n.d(t,"d",(function(){return c.d})),n.d(t,"e",(function(){return c.e})),n.d(t,"f",(function(){return c.f})),n.d(t,"h",(function(){return c.g})),n.d(t,"i",(function(){return c.h}));class l{constructor(t){this.events=new a.EventEmitter,this.handleValueChanged=t=>{const n=t.target;this.emitBlock(e.from(n.value.buffer))},this.device=t,t.addEventListener("gattserverdisconnected",()=>{this.events.emit("disconnected")})}static async requestDevice(){const e=await navigator.bluetooth.requestDevice({filters:[{services:[30326]}],optionalServices:[r.b]});return new l(e)}async connect(){var e;if(this.server=await(null===(e=this.device.gatt)||void 0===e?void 0:e.connect()),void 0===this.server)return;const t=await this.server.getPrimaryService(r.b),n=await t.getCharacteristic(r.c);n.addEventListener("characteristicvaluechanged",this.handleValueChanged),await n.startNotifications()}async disconnect(){var e;try{null===(e=this.device.gatt)||void 0===e||e.disconnect()}catch(e){}this.events.removeAllListeners()}async sendCommand(e){var t;const n=await(null===(t=this.server)||void 0===t?void 0:t.getPrimaryService(r.b));if(void 0===n)return;const a=await n.getCharacteristic(r.a);await a.writeValue(e)}on(e,t){return this.events.on(e,t),()=>{this.events.off(e,t)}}emitBlock(e){try{const t=Object(c.i)(e);void 0===t?this.events.emit("failed",e):this.events.emit("packet",t)}catch(t){this.events.emit("failed",e)}}}}).call(this,n(43).Buffer)},16:function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return s}));var a=n(55);function r(){return u(1)}function c(t){return u(8,e.of(0,t))}function l(t=new Date){const n=e.alloc(4);return n.writeUInt32BE(Math.trunc(t.getTime()/1e3)),u(9,n)}function o(){return u(10)}function i(){return u(11)}function s(t){return u(22,e.of(t?1:0))}function u(t,n=e.of()){const r=e.of(170,t,...n);return e.of(...r,255&a.a.sum(r))}}).call(this,n(43).Buffer)},22:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return c}));const a="6e400001-b5a3-f393-e0a9-e50e24dcca9e",r="6e400002-b5a3-f393-e0a9-e50e24dcca9e",c="6e400003-b5a3-f393-e0a9-e50e24dcca9e"},28:function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return i})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return h}));var a=n(55);class r{constructor(e){m(e,1)}}class c{constructor(e){m(e,10)}}class l{constructor(e){m(e,11),this.pm25=e.readUInt16BE(2),this.recordDate=new Date(1e3*e.readUInt32BE(6))}}class o{constructor(e){m(e,80),this.capacity=e.readUInt8(3),this.isCharging=Boolean(e.readUInt8(6)),Object.freeze(this),Object.seal(this)}}class i{constructor(e){m(e,80),this.runtime=e.readUInt32BE(3),this.boottime=e.readUInt32BE(7),Object.freeze(this),Object.seal(this)}}class s{constructor(e){m(e,80),this.pm25=e.readUInt16BE(3),this.recordDate=new Date(1e3*e.readUInt32BE(7)),this.currentDate=new Date(1e3*e.readUInt32BE(12)),Object.freeze(this),Object.seal(this)}}class u{constructor(e){m(e,80),this.interval=e.readUInt16BE(3),this.enabled=Boolean(e.readUInt8(5)),Object.freeze(this),Object.seal(this)}}class d{constructor(e){m(e,84),this.minor=e.readUInt16BE(2),this.major=e.readUInt16BE(4),Object.freeze(this),Object.seal(this)}toString(){return`${this.major}.${this.minor}`}}function m(e,t){if(170!==e[0])throw new Error("unexpected header");if(e[1]!==t)throw new Error("unexpected type");if(e[e.length-1]!==(255&a.a.sum(e.slice(0,-1))))throw new Error("unexpected checksum")}const f={aa01:r,aa08:class{constructor(e){m(e,8),this.interval=e.readUInt32BE(2)}},aa09:class{constructor(e){m(e,9),this.date=new Date(1e3*e.readUInt32BE(2))}},aa0a:c,aa0b:l,aa16:class{constructor(e){m(e,22),this.enabled=Boolean(e.readUInt8(2))}},aa5004:o,aa5005:i,aa5006:s,aa5007:u,aa54:d};function h(e){return new(f[e.slice(0,3).toString("hex")]||f[e.slice(0,2).toString("hex")])(e)}},33:function(e,t,n){e.exports={container:"_3Q4jVp-XdRE9lL_y-DHvqZ",table:"_12l9Lp-US87GiC9o0PbHWo",field:"_1BDqlaGx2FzEtv1WMIea58"}},76:function(e,t,n){"use strict";n.r(t);n(56);var a=n(49),r=n.n(a),c=n(0),l=n.n(c),o=n(17),i=n.n(o),s=n(8),u=n(20),d=n(23),m=n(18),f=n(51),h=n(15),E=n(44),v=n(29),p=n(52),b=n.n(p),y=n(53),g=n(13),w=n(16);const j=b()("SENSOR"),O=Object(y.a)(j),C=j("SET_CONNECTED"),D=j("UPDATE_PACKET"),S=O("REQUEST_DEVICE",async()=>g.g.requestDevice()),I=O("CONNECT",async(e,t,n)=>{const{sensor:a}=n();null!==a&&(await a.connect(),t(C(!0)),a.on("disconnected",()=>t(C(!1))),a.on("packet",async e=>(e instanceof g.b&&await a.sendCommand(w.a()),t(D(e)))),a.on("failed",e=>{console.log("Block",e.toString("hex").toUpperCase())}),await a.sendCommand(w.e()))}),B=O("DISCONNECT",async(e,t,n)=>{const{sensor:a}=n();return null==a?void 0:a.disconnect()}),N=O("SEND_MESSAGE",async(e,t,n)=>{const{sensor:a}=n();return null==a?void 0:a.sendCommand(e)}),U=e=>N(w.c(e));var x=Object(v.reducerWithInitialState)(null).case(S.async.done,(e,t)=>t.result),P=n(36),k=n(55);var T=Object(v.reducerWithInitialState)({connected:!1,shuttingdown:!1,latest:{},history:[],historyFully:!1}).case(C,(e,t)=>Object(P.a)(e,e=>{t||(e.shuttingdown=!1,e.latest={}),e.connected=t})).case(D,(e,t)=>Object(P.a)(e,e=>{e.shuttingdown=!1,t instanceof g.a?(e.latest.batteryCapacity=t.capacity,e.latest.batteryCharging=t.isCharging):t instanceof g.c?(e.latest.measurementInterval=t.interval,e.latest.measurementIntervalEnabled=t.enabled):t instanceof g.e?(e.latest.runTime=t.runtime,e.latest.bootTime=t.boottime):t instanceof g.f?(e.latest.pm25=t.pm25,e.latest.recordDate=t.recordDate):t instanceof g.i?e.latest.version=[t.major,t.minor].join("."):t instanceof g.h?e.shuttingdown=!0:t instanceof g.b?(e.history.push({pm25:t.pm25,recordDate:t.recordDate}),e.history=k.a.sortedUniqBy(e.history,e=>{var t;return null===(t=e.recordDate)||void 0===t?void 0:t.getTime()})):t instanceof g.d&&(e.historyFully=!0)}));const M=Object(h.b)(),_=m.d;var L=n(32),A=n.n(L),R=n(105),z=n(97),V=n(106),q=n(98),F=n(99),H=n(107);const G=({value:e})=>{if(void 0===e)return l.a.createElement("span",null,"N/A");const t=J(e);return l.a.createElement("span",null,l.a.createElement("span",null,e," Î¼g/m",l.a.createElement("sup",null,"3")),l.a.createElement("span",null," (",t.replace(/-/g," "),")"))};var W;!function(e){e.Excellent="excellent",e.Good="good",e.LightlyPolluted="lightly-polluted",e.ModeratelyPolluted="moderately-polluted",e.HeavilyPolluted="heavily-polluted",e.SeverelyPolluted="severely-polluted"}(W||(W={}));const J=e=>e<=35?W.Excellent:e<=75?W.Good:e<=115?W.LightlyPolluted:e<=150?W.ModeratelyPolluted:e<=250?W.HeavilyPolluted:W.SeverelyPolluted,$=()=>{const e=Object(s.e)(e=>e.report.history);return l.a.createElement(z.a,{hidden:0===e.length},l.a.createElement("h1",null,"History"," ",l.a.createElement(q.a,{size:"sm",color:"link",onClick:()=>{const t=JSON.stringify(e,null,2),n=document.createElement("a");n.href=URL.createObjectURL(new Blob([t],{type:"application/json"})),n.download=function(){const e=new Date,t=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()];return`history-${t.map(e=>e.toString().padStart(2,"0")).join("")}.json`}(),n.click()}},"Download")),l.a.createElement(F.a,{responsive:!0,borderless:!0,size:"sm"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"#"),l.a.createElement("th",null,"PM ",l.a.createElement("sub",null,"2.5")))),l.a.createElement("tbody",null,e.map(({recordDate:e,pm25:t},n)=>l.a.createElement("tr",{key:n},l.a.createElement("td",null,null==e?void 0:e.toLocaleString()),l.a.createElement("td",null,t))))))};var Q=n(33),K=n.n(Q),X=n(108),Y=n(100),Z=n(101),ee=n(102),te=n(103),ne=n(104);const ae=[5,10,15,30,60,90,120],re=()=>{const[e,t]=l.a.useState(!1),n=Object(s.d)(),a=Object(s.e)(e=>e.report.connected),r=Object(s.e)(e=>e.report.latest.measurementInterval),c=Object(s.e)(e=>e.report.latest.measurementIntervalEnabled),o=()=>t(a&&!e),i=async e=>{t(!1),await n((e=>N(w.d(e)))(e)),await n(U(!0))};return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{onClick:o},c?r+" minutes":"Disabled"),l.a.createElement(X.a,{placement:"bottom",isOpen:e,toggle:o},l.a.createElement(Y.a,null,"Measurement interval"),l.a.createElement(Z.a,null,l.a.createElement("p",null,"Current Interval: ",r," minutes"),l.a.createElement(ee.a,null,ae.map(e=>l.a.createElement(te.a,{onClick:()=>i(e),key:e,active:e===r},e," minutes")))),l.a.createElement(ne.a,null,l.a.createElement(q.a,{color:"primary",onClick:async()=>{t(!1),n(U(!1))},hidden:!c},"Disable"),l.a.createElement(q.a,{color:"secondary",onClick:o},"Cancel"))))},ce=()=>{var e,t;const n=Object(s.d)(),a=Object(s.e)(e=>e.report.connected),r=Object(s.e)(e=>e.report.shuttingdown),c=Object(s.e)(e=>e.report.latest);return l.a.createElement(R.a,{className:K.a.container},l.a.createElement(z.a,null,l.a.createElement(V.a,null,l.a.createElement(q.a,{color:a?"success":"primary",onClick:async()=>{a?await n(B()):(await n(S()),await n(I()))}},a?"Disconnect":"Connect"),l.a.createElement(q.a,{disabled:!a,color:a?"danger":void 0,onClick:()=>n(N(w.f()))},r?"Shutting down":"Shutdown"),l.a.createElement(q.a,{disabled:!a,color:a?"info":void 0,onClick:()=>n(N(w.b()))},"Read history (one-time)"))),l.a.createElement(z.a,null,l.a.createElement("h1",null,"Real-time"),l.a.createElement(F.a,{className:K.a.table,responsive:!0,borderless:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{className:K.a.field},"#"),l.a.createElement("th",null,"Value"))),l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"PM ",l.a.createElement("sub",null,"2.5")),l.a.createElement("td",{className:"text-monospace"},l.a.createElement(G,{value:c.pm25}))),l.a.createElement("tr",null,l.a.createElement("td",null,"Battery"),l.a.createElement("td",null,l.a.createElement(H.a,{value:null!==(e=c.batteryCapacity)&&void 0!==e?e:0},c.batteryCapacity?c.batteryCapacity+"%":"N/A"," ",c.batteryCharging?"(Charging)":"(Discharge)"))),l.a.createElement("tr",null,l.a.createElement("td",null,"Record date"),l.a.createElement("td",{className:"text-monospace"},l.a.createElement(le,{value:c.recordDate}))),l.a.createElement("tr",null,l.a.createElement("td",null,"Runtime"),l.a.createElement("td",{className:"text-monospace"},c.runTime?A()(1e3*c.runTime):"N/A")),l.a.createElement("tr",null,l.a.createElement("td",null,"Boot time"),l.a.createElement("td",{className:"text-monospace"},c.bootTime?A()(1e3*c.bootTime):"N/A")),l.a.createElement("tr",null,l.a.createElement("td",null,"Measurement Interval"),l.a.createElement("td",{className:"text-monospace"},l.a.createElement(re,null))),l.a.createElement("tr",null,l.a.createElement("td",null,"Firmare Version"),l.a.createElement("td",{className:"text-monospace"},null!==(t=c.version)&&void 0!==t?t:"N/A"))))),l.a.createElement($,null))},le=({value:e})=>void 0===e?l.a.createElement("span",null,"N/A"):l.a.createElement("span",null,e.toLocaleString()," (Delay: ",A()(Date.now()-e.getTime()),")"),oe=Object(m.e)((ie=M,Object(m.c)({router:Object(d.b)(ie),sensor:x,report:T})),void 0,_(Object(m.a)(Object(E.a)(M),f.a)));var ie;const se=()=>l.a.createElement(s.a,{store:oe},l.a.createElement(d.a,{history:M},l.a.createElement(u.c,null,l.a.createElement(u.a,{exact:!0,path:"/",component:ce}))));r()(()=>{const e=document.createElement("main");document.body=document.createElement("body"),document.body.appendChild(e),i.a.render(l.a.createElement(se),e)})}});
//# sourceMappingURL=main.js.map